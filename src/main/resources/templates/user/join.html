<!DOCTYPE html>
<html lang="ko" 
    xmlns:th="http://www.thymeleaf.org" 
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layouts/middleDefault}">
        
        <section layout:fragment="contents" class="contents d-flex justify-content-center">
            <div class="input-box my-5 p-5 rounded-lg">
                <input type="text" placeholder="이메일 주소" class="form-control mt-2" id="emailInput">
                <input type="text" placeholder="이름" class="form-control mt-2" id="nameInput">                
                <input type="text" placeholder="아이디" class="form-control mt-4" id="idInput">
                <input type="password" placeholder="비밀번호" class="form-control mt-2" id="passwordInput">
                <input type="password" placeholder="비밀번호 확인" class="form-control mt-2" id="passwordConfirmInput">
                <div class="text-center mt-2">
                    <label>프로필 사진 선택
                    <input type="file" class="mt-2" id="fileInput">
                    </label>
                </div>
                <button type="button" class="btn btn-secondary btn-block mt-3" id="joinBtn">가입</button>
                <div class="text-center mt-3">
                    계정이 있으신가요? <a href="#">로그인</a>
                </div>
                
            </div>
        </section>
        
        <script layout:fragment="script">
            $(document).ready(function(){
                
                $("#joinBtn").on("click", function(){
                    
                    let id = $("#idInput").val();
                    let password = $("#passwordInput").val();
                    let passwordConfirm = $("#passwordConfirmInput").val();
                    let name = $("#nameInput").val();
                    let email = $("#emailInput").val();
                    
                    let file = $("#fileInput")[0].files[0];
                    
                    if(id == ""){
                        alert("아이디를 입력하세요");
                        return;
                    }
                    if(password == ""){
                        alert("비밀번호를 입력하세요");
                        return;
                    }
                    if(password != passwordConfirm){
                        alert("비밀번호가 일치하지 않습니다");
                        return;
                    }
                    if(name == ""){
                        alert("이름을 입력하세요");
                        return;
                    }
                    if(email == ""){
                        alert("이메일을 입력하세요");
                        return;
                    }
                
                    let formData = new FormData();
                    formData.append("loginId", id);
                    formData.append("password", password);
                    formData.append("name", name);
                    formData.append("email", email);
                    formData.append("profileImageFile", file);
                    
                    $.ajax({
                        type:"post"
                        , url: "/user/join"
                        , data: formData
                        , enctype: "multipart/form-data" // 파일 업로드 필수
                        , processData: false // 파일 업로드 필수
                        , contentType: false // 파일 업로드 필수
                        , success:function(data){
                            if(data.result == "success"){
                                location.href = "/user/login-view";
                            }else if(data.result == "fail"){
                                alert("회원가입 실패!");
                            }
                        }
                        , error:function(){
                            alert("회원가입 에러!!");
                        }
                    });
                });             
            });
        </script>
</html>